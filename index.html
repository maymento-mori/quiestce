
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qui est-ce? - Jeu 2 Joueurs</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        import React, { useState } from 'react';
        import { Users, RotateCcw, Eye, Trophy } from 'lucide-react';
        export default function GuessWhoGame() {
          const [phase, setPhase] = useState('config'); // config, setup, assignSecret, game, roundEnd
          const [totalRounds, setTotalRounds] = useState(3);
          const [currentRound, setCurrentRound] = useState(1);
          const [player1Score, setPlayer1Score] = useState(0);
          const [player2Score, setPlayer2Score] = useState(0);
          
          const [currentPlayer, setCurrentPlayer] = useState(1);
          const [nameInput, setNameInput] = useState('');
          const [allNames, setAllNames] = useState([]);
          const [player1Secret, setPlayer1Secret] = useState('');
          const [player2Secret, setPlayer2Secret] = useState('');
          const [error, setError] = useState('');
          const [eliminatedByP1, setEliminatedByP1] = useState([]);
          const [eliminatedByP2, setEliminatedByP2] = useState([]);
          const [gameCurrentPlayer, setGameCurrentPlayer] = useState(1);
          const [roundWinner, setRoundWinner] = useState(null);

          const startGame = () => {
            if (totalRounds < 1) {
              setError('Choisissez au moins 1 partie');
              return;
            }
            setPhase('setup');
            setError('');
          };

          const handleAddName = () => {
            const trimmedName = nameInput.trim();
            
            if (!trimmedName) {
              setError('Veuillez entrer un prénom');
              return;
            }

            if (allNames.includes(trimmedName.toLowerCase())) {
              setError('Ce prénom a déjà été ajouté!');
              setNameInput('');
              return;
            }

            const newNames = [...allNames, trimmedName.toLowerCase()];
            setAllNames(newNames);
            setNameInput('');
            setError('');

            if (newNames.length < 20) {
              setCurrentPlayer(currentPlayer === 1 ? 2 : 1);
            }

            if (newNames.length === 20) {
              const shuffled = [...newNames].sort(() => Math.random() - 0.5);
              setPlayer1Secret(shuffled[0]);
              setPlayer2Secret(shuffled[1]);
              setPhase('assignSecret');
              setCurrentPlayer(1);
            }
          };

          const revealAndStartGame = (player) => {
            if (player === 1) {
              setCurrentPlayer(2);
            } else {
              setPhase('game');
              setGameCurrentPlayer(1);
            }
          };

          const toggleEliminate = (name) => {
            if (gameCurrentPlayer === 1) {
              if (eliminatedByP1.includes(name)) {
                setEliminatedByP1(eliminatedByP1.filter(n => n !== name));
              } else {
                setEliminatedByP1([...eliminatedByP1, name]);
              }
            } else {
              if (eliminatedByP2.includes(name)) {
                setEliminatedByP2(eliminatedByP2.filter(n => n !== name));
              } else {
                setEliminatedByP2([...eliminatedByP2, name]);
              }
            }
          };

          const checkWinner = () => {
            // Vérifier si le Joueur 1 n'a qu'un seul personnage restant
            const p1Remaining = allNames.filter(name => !eliminatedByP1.includes(name));
            const p1Won = p1Remaining.length === 1 && p1Remaining[0] === player2Secret;
            const p1Wrong = p1Remaining.length === 1 && p1Remaining[0] !== player2Secret;

            // Vérifier si le Joueur 2 n'a qu'un seul personnage restant
            const p2Remaining = allNames.filter(name => !eliminatedByP2.includes(name));
            const p2Won = p2Remaining.length === 1 && p2Remaining[0] === player1Secret;
            const p2Wrong = p2Remaining.length === 1 && p2Remaining[0] !== player1Secret;

            let winner = null;
            const resultMessage = `Joueur 1 devait deviner "${player2Secret}" et Joueur 2 devait deviner "${player1Secret}"`;
            
            // Si un joueur s'est trompé, l'autre gagne automatiquement
            if (p1Wrong && p2Remaining.length > 1) {
              setPlayer2Score(player2Score + 1);
              winner = 2;
              setError(resultMessage);
            } else if (p2Wrong && p1Remaining.length > 1) {
              setPlayer1Score(player1Score + 1);
              winner = 1;
              setError(resultMessage);
            } else if (p1Wrong && p2Wrong) {
              // Les deux se sont trompés - pas de point
              winner = 'draw';
              setError(resultMessage);
            } else if (p1Won && p2Won) {
              // Égalité - les deux ont trouvé
              winner = 'draw';
              setError(resultMessage);
            } else if (p1Won && p2Remaining.length > 1) {
              setPlayer1Score(player1Score + 1);
              winner = 1;
              setError(resultMessage);
            } else if (p2Won && p1Remaining.length > 1) {
              setPlayer2Score(player2Score + 1);
              winner = 2;
              setError(resultMessage);
            } else if (p1Won) {
              setPlayer1Score(player1Score + 1);
              winner = 1;
              setError(resultMessage);
            } else if (p2Won) {
              setPlayer2Score(player2Score + 1);
              winner = 2;
              setError(resultMessage);
            }

            if (winner) {
              setRoundWinner(winner);
              setPhase('roundEnd');
            } else {
              setGameCurrentPlayer(gameCurrentPlayer === 1 ? 2 : 1);
            }
          };

          const nextRound = () => {
            if (currentRound < totalRounds) {
              // Préparer la prochaine manche
              setCurrentRound(currentRound + 1);
              setPhase('setup');
              setCurrentPlayer(1);
              setNameInput('');
              setAllNames([]);
              setPlayer1Secret('');
              setPlayer2Secret('');
              setEliminatedByP1([]);
              setEliminatedByP2([]);
              setGameCurrentPlayer(1);
              setRoundWinner(null);
              setError('');
            } else {
              // Fin du jeu - afficher les scores finaux
              setPhase('gameEnd');
            }
          };

          const reset = () => {
            setPhase('config');
            setTotalRounds(3);
            setCurrentRound(1);
            setPlayer1Score(0);
            setPlayer2Score(0);
            setCurrentPlayer(1);
            setNameInput('');
            setAllNames([]);
            setPlayer1Secret('');
            setPlayer2Secret('');
            setError('');
            setEliminatedByP1([]);
            setEliminatedByP2([]);
            setGameCurrentPlayer(1);
            setRoundWinner(null);
          };

          return (
            <div className="min-h-screen bg-gradient-to-br from-purple-500 to-pink-500 p-4">
              <div className="max-w-2xl mx-auto">
                
                {/* Configuration initiale */}
                {phase === 'config' && (
                  <div className="bg-white rounded-2xl shadow-2xl p-8">
                    <div className="text-center mb-8">
                      <Users className="w-16 h-16 mx-auto mb-4 text-purple-600" />
                      <h1 className="text-4xl font-bold text-gray-800 mb-2">Qui est-ce?</h1>
                      <p className="text-gray-600">Jeu à 2 joueurs</p>
                    </div>

                    <div className="space-y-6">
                      <div>
                        <label className="block text-lg font-medium text-gray-700 mb-3">
                          Combien de manches voulez-vous jouer ?
                        </label>
                        <input
                          type="number"
                          min="1"
                          max="10"
                          value={totalRounds}
                          onChange={(e) => setTotalRounds(parseInt(e.target.value) || 1)}
                          className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none text-2xl text-center font-bold"
                        />
                      </div>

                      {error && (
                        <div className="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded">
                          {error}
                        </div>
                      )}

                      <button
                        onClick={startGame}
                        className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-lg font-bold text-xl hover:from-purple-700 hover:to-pink-700 transition-all"
                      >
                        Commencer la partie
                      </button>
                    </div>
                  </div>
                )}

                {/* Affichage du score permanent en haut */}
                {phase !== 'config' && phase !== 'gameEnd' && (
                  <div className="bg-white rounded-xl shadow-lg p-4 mb-4">
                    <div className="flex justify-between items-center">
                      <div className="text-center flex-1">
                        <p className="text-sm text-gray-600">Joueur 1</p>
                        <p className="text-3xl font-bold text-blue-600">{player1Score}</p>
                      </div>
                      <div className="text-center flex-1">
                        <p className="text-lg font-bold text-gray-700">Manche {currentRound}/{totalRounds}</p>
                      </div>
                      <div className="text-center flex-1">
                        <p className="text-sm text-gray-600">Joueur 2</p>
                        <p className="text-3xl font-bold text-pink-600">{player2Score}</p>
                      </div>
                    </div>
                  </div>
                )}
                
                {/* Phase de configuration */}
                {phase === 'setup' && (
                  <div className="bg-white rounded-2xl shadow-2xl p-8">
                    <div className="text-center mb-8">
                      <h2 className="text-2xl font-bold text-gray-800 mb-2">Manche {currentRound}</h2>
                      <p className="text-gray-600">Ajoutez 20 prénoms</p>
                    </div>

                    <div className="mb-6">
                      <div className="flex justify-between items-center mb-4">
                        <span className="text-lg font-semibold text-gray-700">
                          Progression: {allNames.length}/20 prénoms
                        </span>
                        <span className={`px-4 py-2 rounded-full font-bold ${
                          currentPlayer === 1 ? 'bg-blue-500 text-white' : 'bg-pink-500 text-white'
                        }`}>
                          Joueur {currentPlayer}
                        </span>
                      </div>
                      
                      <div className="w-full bg-gray-200 rounded-full h-3 mb-6">
                        <div 
                          className="bg-gradient-to-r from-blue-500 to-pink-500 h-3 rounded-full transition-all duration-300"
                          style={{ width: `${(allNames.length / 20) * 100}%` }}
                        />
                      </div>
                    </div>

                    <div className="space-y-4">
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Entrez un prénom que vous connaissez tous les deux:
                        </label>
                        <input
                          type="text"
                          value={nameInput}
                          onChange={(e) => setNameInput(e.target.value)}
                          onKeyPress={(e) => e.key === 'Enter' && handleAddName()}
                          className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none text-lg"
                          placeholder="Ex: Marie, Thomas..."
                          autoFocus
                        />
                      </div>

                      {error && (
                        <div className="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded">
                          {error}
                        </div>
                      )}

                      <button
                        onClick={handleAddName}
                        className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3 rounded-lg font-bold text-lg hover:from-purple-700 hover:to-pink-700 transition-all"
                      >
                        Ajouter le prénom
                      </button>
                    </div>

                    {allNames.length > 0 && (
                      <div className="mt-6">
                        <h3 className="font-semibold text-gray-700 mb-3">Prénoms ajoutés:</h3>
                        <div className="grid grid-cols-2 gap-2 max-h-48 overflow-y-auto">
                          {allNames.map((name, idx) => (
                            <div key={idx} className="bg-gray-100 px-3 py-2 rounded-lg capitalize text-sm">
                              {name}
                            </div>
                          ))}
                        </div>
                      </div>
                    )}
                  </div>
                )}

                {/* Phase d'assignation des secrets */}
                {phase === 'assignSecret' && (
                  <div className="bg-white rounded-2xl shadow-2xl p-8">
                    <div className="text-center mb-8">
                      <Eye className="w-16 h-16 mx-auto mb-4 text-purple-600" />
                      <h1 className="text-3xl font-bold text-gray-800 mb-2">Attribution des personnages</h1>
                      <p className="text-gray-600">Chaque joueur doit voir son personnage secret</p>
                    </div>

                    {currentPlayer === 1 && (
                      <div className="space-y-6">
                        <div className="bg-blue-50 border-4 border-blue-500 rounded-2xl p-8 text-center">
                          <h2 className="text-2xl font-bold text-blue-600 mb-4">Joueur 1</h2>
                          <p className="text-gray-700 mb-4">Ton personnage secret (que le Joueur 2 doit deviner) :</p>
                          <p className="text-5xl font-bold text-blue-600 capitalize mb-6">{player1Secret}</p>
                          <p className="text-sm text-gray-600 mb-6">Mémorise-le bien !</p>
                          <button
                            onClick={() => revealAndStartGame(1)}
                            className="px-8 py-3 bg-blue-500 text-white rounded-lg font-bold text-lg hover:bg-blue-600 transition-all"
                          >
                            J'ai mémorisé - Passer au Joueur 2
                          </button>
                        </div>
                      </div>
                    )}

                    {currentPlayer === 2 && (
                      <div className="space-y-6 transform rotate-180">
                        <div className="bg-pink-50 border-4 border-pink-500 rounded-2xl p-8 text-center">
                          <h2 className="text-2xl font-bold text-pink-600 mb-4">Joueur 2</h2>
                          <p className="text-gray-700 mb-4">Ton personnage secret (que le Joueur 1 doit deviner) :</p>
                          <p className="text-5xl font-bold text-pink-600 capitalize mb-6">{player2Secret}</p>
                          <p className="text-sm text-gray-600 mb-6">Mémorise-le bien !</p>
                          <button
                            onClick={() => revealAndStartGame(2)}
                            className="px-8 py-3 bg-pink-500 text-white rounded-lg font-bold text-lg hover:bg-pink-600 transition-all"
                          >
                            J'ai mémorisé - Commencer le jeu
                          </button>
                        </div>
                      </div>
                    )}
                  </div>
                )}

                {/* Phase de jeu */}
                {phase === 'game' && (
                  <div className={`bg-white rounded-2xl shadow-2xl p-8 transition-all duration-500 ${
                    gameCurrentPlayer === 2 ? 'transform rotate-180' : ''
                  }`}>
                    <div className="text-center mb-6">
                      <div className="flex justify-between items-center mb-4">
                        <button
                          onClick={reset}
                          className="inline-flex items-center gap-2 px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors"
                        >
                          <RotateCcw className="w-4 h-4" />
                          Recommencer
                        </button>
                        <h2 className={`text-2xl font-bold ${
                          gameCurrentPlayer === 1 ? 'text-blue-600' : 'text-pink-600'
                        }`}>
                          Tour du Joueur {gameCurrentPlayer}
                        </h2>
                      </div>
                      <p className="text-gray-600 mb-4">Clique sur les personnages pour les éliminer</p>
                    </div>

                    {/* Grille de personnages */}
                    <div className="grid grid-cols-3 gap-3 mb-6">
                      {allNames.map((name, idx) => {
                        const isEliminated = gameCurrentPlayer === 1 
                          ? eliminatedByP1.includes(name)
                          : eliminatedByP2.includes(name);
                        
                        return (
                          <button
                            key={idx}
                            onClick={() => toggleEliminate(name)}
                            className={`px-4 py-3 rounded-lg font-medium capitalize transition-all ${
                              isEliminated
                                ? 'bg-gray-300 text-gray-500 line-through opacity-50'
                                : gameCurrentPlayer === 1
                                ? 'bg-blue-100 text-blue-800 hover:bg-blue-200 border-2 border-blue-300'
                                : 'bg-pink-100 text-pink-800 hover:bg-pink-200 border-2 border-pink-300'
                            }`}
                          >
                            {name}
                          </button>
                        );
                      })}
                    </div>

                    {/* Stats */}
                    <div className="bg-gray-50 rounded-lg p-4 mb-6">
                      <div className="flex justify-around text-center">
                        <div>
                          <p className="text-2xl font-bold text-gray-800">
                            {gameCurrentPlayer === 1 
                              ? allNames.length - eliminatedByP1.length
                              : allNames.length - eliminatedByP2.length
                            }
                          </p>
                          <p className="text-sm text-gray-600">Personnages restants</p>
                        </div>
                        <div>
                          <p className="text-2xl font-bold text-gray-800">
                            {gameCurrentPlayer === 1 ? eliminatedByP1.length : eliminatedByP2.length}
                          </p>
                          <p className="text-sm text-gray-600">Éliminés</p>
                        </div>
                      </div>
                    </div>

                    {/* Bouton changer de tour */}
                    <button
                      onClick={checkWinner}
                      className={`w-full py-4 rounded-lg font-bold text-lg text-white transition-all ${
                        gameCurrentPlayer === 1
                          ? 'bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800'
                          : 'bg-gradient-to-r from-pink-600 to-pink-700 hover:from-pink-700 hover:to-pink-800'
                      }`}
                    >
                      Terminer mon tour
                    </button>
                  </div>
                )}

                {/* Fin de manche */}
                {phase === 'roundEnd' && (
                  <div className="bg-white rounded-2xl shadow-2xl p-8">
                    <div className="text-center mb-8">
                      <Trophy className="w-20 h-20 mx-auto mb-4 text-yellow-500" />
                      <h1 className="text-4xl font-bold text-gray-800 mb-4">Fin de la manche {currentRound}</h1>
                      
                      {error && (
                        <div className="bg-orange-100 border-l-4 border-orange-500 text-orange-700 p-4 rounded mb-4">
                          {error}
                        </div>
                      )}
                      
                      {roundWinner === 'draw' && !error && (
                        <p className="text-2xl text-gray-600">Égalité ! Pas de point</p>
                      )}
                      {roundWinner === 1 && (
                        <div>
                          <p className="text-2xl text-blue-600 font-bold mb-2">🎉 Le Joueur 1 gagne ! 🎉</p>
                          {!error && <p className="text-lg text-gray-600">Il a trouvé : {player2Secret}</p>}
                        </div>
                      )}
                      {roundWinner === 2 && (
                        <div>
                          <p className="text-2xl text-pink-600 font-bold mb-2">🎉 Le Joueur 2 gagne ! 🎉</p>
                          {!error && <p className="text-lg text-gray-600">Il a trouvé : {player1Secret}</p>}
                        </div>
                      )}
                    </div>

                    <div className="bg-gray-50 rounded-xl p-6 mb-8">
                      <h3 className="text-xl font-bold text-gray-700 mb-4 text-center">Score actuel</h3>
                      <div className="flex justify-around">
                        <div className="text-center">
                          <p className="text-sm text-gray-600 mb-2">Joueur 1</p>
                          <p className="text-5xl font-bold text-blue-600">{player1Score}</p>
                        </div>
                        <div className="text-center">
                          <p className="text-sm text-gray-600 mb-2">Joueur 2</p>
                          <p className="text-5xl font-bold text-pink-600">{player2Score}</p>
                        </div>
                      </div>
                    </div>

                    <button
                      onClick={nextRound}
                      className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-lg font-bold text-xl hover:from-purple-700 hover:to-pink-700 transition-all"
                    >
                      {currentRound < totalRounds ? 'Manche suivante' : 'Voir les résultats finaux'}
                    </button>
                  </div>
                )}

                {/* Fin de partie */}
                {phase === 'gameEnd' && (
                  <div className="bg-white rounded-2xl shadow-2xl p-8">
                    <div className="text-center mb-8">
                      <Trophy className="w-24 h-24 mx-auto mb-4 text-yellow-500" />
                      <h1 className="text-4xl font-bold text-gray-800 mb-4">Partie terminée !</h1>
                      
                      {player1Score > player2Score && (
                        <p className="text-3xl font-bold text-blue-600 mb-2">🎉 Le Joueur 1 remporte la partie ! 🎉</p>
                      )}
                      {player2Score > player1Score && (
                        <p className="text-3xl font-bold text-pink-600 mb-2">🎉 Le Joueur 2 remporte la partie ! 🎉</p>
                      )}
                      {player1Score === player2Score && (
                        <p className="text-3xl font-bold text-gray-700 mb-2">🤝 Égalité parfaite ! 🤝</p>
                      )}
                    </div>

                    <div className="bg-gradient-to-r from-blue-50 to-pink-50 rounded-xl p-8 mb-8">
                      <h3 className="text-2xl font-bold text-gray-700 mb-6 text-center">Score final</h3>
                      <div className="flex justify-around">
                        <div className="text-center">
                          <p className="text-lg text-gray-600 mb-2">Joueur 1</p>
                          <p className="text-6xl font-bold text-blue-600">{player1Score}</p>
                        </div>
                        <div className="text-center">
                          <p className="text-lg text-gray-600 mb-2">Joueur 2</p>
                          <p className="text-6xl font-bold text-pink-600">{player2Score}</p>
                        </div>
                      </div>
                    </div>

                    <button
                      onClick={reset}
                      className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-lg font-bold text-xl hover:from-purple-700 hover:to-pink-700 transition-all"
                    >
                      Nouvelle partie
                    </button>
                  </div>
                )}
              </div>
            </div>
          );
        }
    </script>
</body>
</html>


